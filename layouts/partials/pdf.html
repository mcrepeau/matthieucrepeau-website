<!-- Container for the PDF -->
<div id="pdf-container"></div>

<!-- Include PDF.js library from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<!-- Set worker URL for PDF.js -->
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>

<!-- JavaScript code to load and render the PDF -->
<script>
  // Path to your PDF file (assuming you specify the PDF URL in the page front matter)
  const pdfUrl = '{{ .Page.Params.pdf_url }}';

  // Fetch the PDF document
  pdfjsLib.getDocument({
    url: pdfUrl
  }).promise.then(pdf => {
    // Render the first page
    pdf.getPage(1).then(page => {
      const scale = 1.5;
      const viewport = page.getViewport({ scale });

      // Prepare canvas using PDF page dimensions
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      // Render PDF page into canvas context
      const renderContext = {
        canvasContext: context,
        viewport: viewport
      };
      page.render(renderContext).promise.then(() => {
        // Append canvas to PDF container
        document.getElementById('pdf-container').appendChild(canvas);
        
        // Enable text selection
        page.getTextContent().then(textContent => {
          const textLayerDiv = document.createElement('div');
          textLayerDiv.className = 'textLayer';
          const textLayer = new TextLayerBuilder({
            textLayerDiv,
            pageIndex: 0,
            viewport: viewport
          });
          textLayer.setTextContent(textContent);
          textLayer.render();
          document.getElementById('pdf-container').appendChild(textLayerDiv);
        });
      });
    });
  });

  // Function to trigger PDF download
  function downloadPDF() {
    const link = document.createElement('a');
    link.href = pdfUrl; // Set the PDF URL
    link.download = 'matthieu-crepeau-resume.pdf'; // Set the filename for download
    link.click();
  }
</script>